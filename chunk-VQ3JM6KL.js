import{a as Y}from"./chunk-L5MRLHN3.js";import{d as R,e as y,f as G,g as j,i as F,m as T,n as $,s as Z}from"./chunk-LNG6NYX7.js";import{$ as m,Bb as H,Cb as L,Db as A,Eb as N,Fb as d,Gb as P,Hb as k,Ja as a,Sa as U,Ya as O,a as C,aa as u,b as M,ba as v,bb as h,ca as w,ha as z,hb as c,ib as i,jb as o,kb as f,la as D,ob as V,pb as B,qb as b,tb as x,vb as g}from"./chunk-XSFV2FAY.js";function K(n,t){if(n&1){let e=b();i(0,"button",4),x("click",function(){m(e);let l=g();return u(l.onBack())}),v(),i(1,"svg",5),f(2,"line",6)(3,"polyline",7),o(),w(),i(4,"span"),d(5,"Volver"),o()()}}var S=class n{title="";showBackButton=!0;back=new z;onBack(){this.back.emit()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=O({type:n,selectors:[["app-page-header"]],inputs:{title:"title",showBackButton:"showBackButton"},outputs:{back:"back"},decls:6,vars:2,consts:[[1,"page-header"],["class","back-btn",3,"click",4,"ngIf"],[1,"header-title"],[1,"header-spacer"],[1,"back-btn",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["x1","19","y1","12","x2","5","y2","12"],["points","12 19 5 12 12 5"]],template:function(e,r){e&1&&(i(0,"header",0),h(1,K,6,0,"button",1),i(2,"div",2)(3,"h1"),d(4),o()(),f(5,"div",3),o()),e&2&&(a(),c("ngIf",r.showBackButton),a(3),P(r.title))},dependencies:[F,y],styles:[".page-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:20px 32px;background:#2d2d2d;border-bottom:1px solid #3d3d3d;position:sticky;top:0;z-index:100;box-shadow:0 2px 8px #00000026}.back-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:10px 18px;background:transparent;border:1px solid #565869;border-radius:10px;color:#ececec;font-size:.95rem;font-weight:500;cursor:pointer;transition:all .2s ease}.back-btn[_ngcontent-%COMP%]:hover{background:#3d3d3d;border-color:#6e6e80;transform:translate(-2px)}.back-btn[_ngcontent-%COMP%]:active{transform:translate(-1px)}.back-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.header-title[_ngcontent-%COMP%]{flex:1;text-align:center}.header-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#ececec;margin:0;letter-spacing:-.02em}.header-spacer[_ngcontent-%COMP%]{width:110px}"]})};function J(n,t){if(n&1&&(i(0,"div",32),f(1,"div",33),o()),n&2){let e=g().$implicit;a(),L("width",e.progress,"%")}}function Q(n,t){if(n&1&&(i(0,"div",34),d(1),o()),n&2){let e=g().$implicit;a(),k(" ",e.error," ")}}function ee(n,t){n&1&&(i(0,"span"),d(1,"Pendiente"),o())}function te(n,t){if(n&1&&(i(0,"span"),d(1),o()),n&2){let e=g().$implicit;a(),k("",e.progress,"%")}}function ne(n,t){n&1&&(i(0,"span"),d(1,"\u2713 Completado"),o())}function ie(n,t){n&1&&(i(0,"span"),d(1,"\u2717 Error"),o())}function oe(n,t){if(n&1){let e=b();i(0,"button",35),x("click",function(){m(e);let l=g().index,p=g(2);return u(p.removeFile(l))}),v(),i(1,"svg",36),f(2,"line",37)(3,"line",38),o()()}}function re(n,t){if(n&1&&(i(0,"div",17)(1,"div",18),v(),i(2,"svg",19),f(3,"path",20)(4,"polyline",21),o()(),w(),i(5,"div",22)(6,"div",23),d(7),o(),i(8,"div",24),d(9),o(),h(10,J,2,2,"div",25)(11,Q,2,1,"div",26),o(),i(12,"div",27)(13,"span",28),V(14,29),h(15,ee,2,0,"span",30)(16,te,2,1,"span",30)(17,ne,2,0,"span",30)(18,ie,2,0,"span",30),B(),o()(),h(19,oe,4,0,"button",31),o()),n&2){let e=t.$implicit,r=g(2);a(7),P(e.file.name),a(2),P(r.formatFileSize(e.file.size)),a(),c("ngIf",e.status==="uploading"),a(),c("ngIf",e.status==="error"),a(2),N(e.status),a(),c("ngSwitch",e.status),a(),c("ngSwitchCase","pending"),a(),c("ngSwitchCase","uploading"),a(),c("ngSwitchCase","success"),a(),c("ngSwitchCase","error"),a(),c("ngIf",e.status!=="uploading")}}function ae(n,t){if(n&1&&(i(0,"div",15)(1,"h3"),d(2),o(),h(3,re,20,12,"div",16),o()),n&2){let e=g();a(2),k("Archivos seleccionados (",e.files().length,")"),a(),c("ngForOf",e.files())}}function le(n,t){if(n&1){let e=b();i(0,"div",39)(1,"button",40),x("click",function(){m(e);let l=g();return u(l.uploadFiles())}),v(),i(2,"svg",36),f(3,"path",8)(4,"polyline",9)(5,"line",10),o(),d(6),o()()}if(n&2){let e=g();a(),c("disabled",!e.hasFilesToUpload||e.isUploading),a(5),k(" ",e.isUploading?"Subiendo...":"Subir Archivos"," ")}}var E=class n{constructor(t,e){this.http=t;this.router=e}files=D([]);isDragging=D(!1);ALLOWED_TYPES=["application/pdf","application/zip","application/x-zip-compressed"];MAX_FILE_SIZE=50*1024*1024;goBack(){this.router.navigate(["/chat"])}onDragOver(t){t.preventDefault(),t.stopPropagation(),this.isDragging.set(!0)}onDragLeave(t){t.preventDefault(),t.stopPropagation(),this.isDragging.set(!1)}onDrop(t){t.preventDefault(),t.stopPropagation(),this.isDragging.set(!1);let e=t.dataTransfer?.files;e&&this.handleFiles(Array.from(e))}onFileSelected(t){let e=t.target;e.files&&(this.handleFiles(Array.from(e.files)),e.value="")}handleFiles(t){let r=t.filter(l=>this.validateFile(l)).map(l=>({file:l,progress:0,status:"pending"}));this.files.update(l=>[...l,...r])}validateFile(t){return this.ALLOWED_TYPES.includes(t.type)?t.size>this.MAX_FILE_SIZE?(alert(`Archivo muy grande: ${t.name}. M\xE1ximo 50MB.`),!1):!0:(alert(`Archivo no permitido: ${t.name}. Solo se permiten PDF y ZIP.`),!1)}removeFile(t){this.files.update(e=>e.filter((r,l)=>l!==t))}uploadFiles(){this.files().filter(e=>e.status==="pending").forEach((e,r)=>{this.uploadSingleFile(e,this.files().indexOf(e))})}uploadSingleFile(t,e){let r=new FormData;r.append("file",t.file),this.files.update(p=>{let s=[...p];return s[e]=M(C({},s[e]),{status:"uploading"}),s}),this.http.post("/api/rag/upload",r,{reportProgress:!0,observe:"events"}).subscribe({next:p=>{if(p.type===T.UploadProgress&&p.total){let s=Math.round(100*p.loaded/p.total);this.files.update(_=>{let I=[..._];return I[e]=M(C({},I[e]),{progress:s}),I})}else p.type===T.Response&&this.files.update(s=>{let _=[...s];return _[e]=M(C({},_[e]),{status:"success",progress:100}),_})},error:p=>{this.files.update(s=>{let _=[...s];return _[e]=M(C({},_[e]),{status:"error",error:p.message||"Error al subir archivo"}),_})}})}get hasFilesToUpload(){return this.files().some(t=>t.status==="pending")}get isUploading(){return this.files().some(t=>t.status==="uploading")}formatFileSize(t){if(t===0)return"0 Bytes";let e=1024,r=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(t)/Math.log(e));return Math.round(t/Math.pow(e,l)*100)/100+" "+r[l]}static \u0275fac=function(e){return new(e||n)(U($),U(Z))};static \u0275cmp=O({type:n,selectors:[["app-file-upload"]],decls:23,vars:4,consts:[["fileInput",""],[1,"app-layout"],[1,"upload-area"],["title","Cargar Documentos al RAG",3,"back"],[1,"upload-container"],[1,"upload-intro"],[1,"drop-zone",3,"dragover","dragleave","drop","click"],["width","64","height","64","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["d","M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"],["points","17 8 12 3 7 8"],["x1","12","y1","3","x2","12","y2","15"],[1,"file-types"],["type","file","multiple","","accept",".pdf,.zip",2,"display","none",3,"change"],["class","files-list",4,"ngIf"],["class","upload-actions",4,"ngIf"],[1,"files-list"],["class","file-item",4,"ngFor","ngForOf"],[1,"file-item"],[1,"file-icon"],["width","24","height","24","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["d","M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"],["points","13 2 13 9 20 9"],[1,"file-info"],[1,"file-name"],[1,"file-size"],["class","progress-bar",4,"ngIf"],["class","file-error",4,"ngIf"],[1,"file-status"],[1,"status-badge"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","remove-btn",3,"click",4,"ngIf"],[1,"progress-bar"],[1,"progress-fill"],[1,"file-error"],[1,"remove-btn",3,"click"],["width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2"],["x1","18","y1","6","x2","6","y2","18"],["x1","6","y1","6","x2","18","y2","18"],[1,"upload-actions"],[1,"upload-btn",3,"click","disabled"]],template:function(e,r){if(e&1){let l=b();i(0,"div",1),f(1,"app-sidebar"),i(2,"div",2)(3,"app-page-header",3),x("back",function(){return m(l),u(r.goBack())}),o(),i(4,"div",4)(5,"div",5)(6,"p"),d(7,"Sube archivos PDF o ZIP para alimentar la base de conocimiento"),o()(),i(8,"div",6),x("dragover",function(s){return m(l),u(r.onDragOver(s))})("dragleave",function(s){return m(l),u(r.onDragLeave(s))})("drop",function(s){return m(l),u(r.onDrop(s))})("click",function(){m(l);let s=H(20);return u(s.click())}),v(),i(9,"svg",7),f(10,"path",8)(11,"polyline",9)(12,"line",10),o(),w(),i(13,"h3"),d(14,"Arrastra archivos aqu\xED"),o(),i(15,"p"),d(16,"o haz clic para seleccionar"),o(),i(17,"span",11),d(18,"PDF o ZIP (m\xE1x. 50MB)"),o(),i(19,"input",12,0),x("change",function(s){return m(l),u(r.onFileSelected(s))}),o()(),h(21,ae,4,2,"div",13)(22,le,7,2,"div",14),o()()()}e&2&&(a(8),A("dragging",r.isDragging()),a(13),c("ngIf",r.files().length>0),a(),c("ngIf",r.files().length>0))},dependencies:[F,R,y,G,j,S,Y],styles:["[_nghost-%COMP%]{display:block;height:100vh}.app-layout[_ngcontent-%COMP%]{display:flex;height:100%;background-color:#343541}.upload-area[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;height:100%;overflow:hidden}.upload-container[_ngcontent-%COMP%]{flex:1;overflow-y:auto;max-width:900px;margin:0 auto;padding:40px 20px;width:100%}.upload-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.upload-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#2d2d2d}.upload-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#565869;border-radius:4px}.upload-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#6e6e80}.upload-intro[_ngcontent-%COMP%]{text-align:center;margin-bottom:40px}.upload-intro[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#8e8ea0;font-size:1rem;line-height:1.5}.drop-zone[_ngcontent-%COMP%]{border:2px dashed #565869;border-radius:16px;padding:60px 40px;text-align:center;background:#40414f;cursor:pointer;transition:all .3s ease}.drop-zone[_ngcontent-%COMP%]:hover{border-color:#6e6e80;background:#444654}.drop-zone.dragging[_ngcontent-%COMP%]{border-color:#4cc9f0;background:#444654;transform:scale(1.02);box-shadow:0 0 20px #4cc9f04d}.drop-zone[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#8e8ea0;margin-bottom:20px}.drop-zone[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin-bottom:8px;color:#ececec}.drop-zone[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#8e8ea0;margin-bottom:12px}.drop-zone[_ngcontent-%COMP%]   .file-types[_ngcontent-%COMP%]{display:inline-block;background:#2d2d2d;color:#8e8ea0;padding:6px 12px;border-radius:6px;font-size:.85rem}.files-list[_ngcontent-%COMP%]{margin-top:40px}.files-list[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;margin-bottom:20px;color:#ececec}.file-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;background:#40414f;border:1px solid #565869;border-radius:12px;padding:16px;margin-bottom:12px;transition:all .2s ease}.file-item[_ngcontent-%COMP%]:hover{background:#444654;border-color:#6e6e80}.file-icon[_ngcontent-%COMP%]{flex-shrink:0;width:40px;height:40px;background:#2d2d2d;border-radius:8px;display:flex;align-items:center;justify-content:center;color:#4cc9f0}.file-info[_ngcontent-%COMP%]{flex:1;min-width:0}.file-info[_ngcontent-%COMP%]   .file-name[_ngcontent-%COMP%]{font-weight:500;color:#ececec;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.file-info[_ngcontent-%COMP%]   .file-size[_ngcontent-%COMP%]{font-size:.85rem;color:#8e8ea0}.file-info[_ngcontent-%COMP%]   .file-error[_ngcontent-%COMP%]{font-size:.85rem;color:#ff6b6b;margin-top:4px}.progress-bar[_ngcontent-%COMP%]{width:100%;height:4px;background:#2d2d2d;border-radius:2px;margin-top:8px;overflow:hidden}.progress-bar[_ngcontent-%COMP%]   .progress-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#4cc9f0,#4361ee);transition:width .3s ease}.file-status[_ngcontent-%COMP%]{flex-shrink:0}.status-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 12px;border-radius:6px;font-size:.85rem;font-weight:500}.status-badge.pending[_ngcontent-%COMP%]{background:#2d2d2d;color:#8e8ea0}.status-badge.uploading[_ngcontent-%COMP%]{background:#4cc9f033;color:#4cc9f0}.status-badge.success[_ngcontent-%COMP%]{background:#4cf08c33;color:#4cf08c}.status-badge.error[_ngcontent-%COMP%]{background:#ff6b6b33;color:#ff6b6b}.remove-btn[_ngcontent-%COMP%]{flex-shrink:0;width:32px;height:32px;background:transparent;border:none;border-radius:6px;color:#8e8ea0;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.remove-btn[_ngcontent-%COMP%]:hover{background:#565869;color:#ececec}.upload-actions[_ngcontent-%COMP%]{margin-top:30px;display:flex;justify-content:center}.upload-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:14px 32px;background:linear-gradient(90deg,#4361ee,#3f37c9);border:none;border-radius:12px;color:#fff;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s ease}.upload-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 15px #4361ee66}.upload-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed;transform:none}.upload-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}"]})};var Oe=[{path:"",component:E}];export{Oe as FILE_UPLOAD_ROUTES};
